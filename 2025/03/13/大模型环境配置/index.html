
<!DOCTYPE html>
<html lang="Zh-CN">
<head>
    <meta charset="utf-8" />
    <title>大模型环境配置 | SharlotAway</title>
    <meta name="author" content="Sharlot Away" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar_f.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading_furina.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>SHARLOTAWAY</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about/">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags/">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;SHARLOTAWAY</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>大模型环境配置</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/3/13
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/Environment/" style="color: #ff7d73">
                    Environment
                </a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <p>这篇文章介绍在运行大模型之前的配置，包括从 Windows 平台远程连接 Linux 服务器，CUDA 和 cudnn 配置以及 Anaconda 的配置。</p>
<h2 id="0-VSCode配置远程连接"><a href="#0-VSCode配置远程连接" class="headerlink" title="0. VSCode配置远程连接"></a>0. VSCode配置远程连接</h2><p>安装 <code>VSCode</code> 中的<code>Remote-SSH</code> 扩展，修改<code>ssh</code> 配置文件（可以在 VSCode 中打开新页面，然后 <code>ctrl</code>+<code>shift</code>+<code>p</code> 选择连接到主机）</p>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102162325268.png"></p>
<p>选择“连接到主机”，可以看到已经连接过的主机以及添加和配置两个选项。</p>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102162357675.png"></p>
<p>可以“+添加新的 SSH 主机“，然后输入 按照提示格式输入<code>ssh &lt;User&gt;@&lt;HostName&gt;:&lt;Port&gt; -&lt;Host&gt;</code> 建立新的连接。</p>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102162415763.png"></p>
<p>新建完成后就会在配置文件中出现相应的内容，格式如下。如果要修改连接的名称，修改 <code>&lt;Host&gt;</code> 即可。</p>
<pre><code class="bash">Host &lt;Host&gt;
  HostName &lt;HostName&gt;
  User &lt;User&gt;
  Port &lt;Port&gt;
</code></pre>
<p>然后打开，输入密码即可，如果需要配置免密登录，将主机的<code>id_rsa.pub</code> 中的内容粘贴到服务器 <code>.ssh</code> 下的<code>authorized_keys</code> 即可。</p>
<h2 id="1-Anaconda"><a href="#1-Anaconda" class="headerlink" title="1. Anaconda"></a>1. Anaconda</h2><h3 id="1-1-下载并在本地配置-Anaconda"><a href="#1-1-下载并在本地配置-Anaconda" class="headerlink" title="1.1 下载并在本地配置 Anaconda"></a>1.1 下载并在本地配置 Anaconda</h3><p>从<a target="_blank" rel="noopener" href="https://www.anaconda.com/download/success">官网</a> 下载最新的 Anaconda3，选择相应 Linux 版本，在指定目录下使用 <code>wget</code> 进行下载。可以根据需求下载 Anaconda 或者 Miniconda。</p>
<pre><code class="bash"># /bin/bash
wget https://repo.anaconda.com/archive/Anaconda3-2024.10-1-Linux-x86_64.sh # Anaconda
bash Anaconda3-2024.10-1-Linux-x86_64.sh
</code></pre>
<p>Miniconda</p>
<pre><code class="bash"># /bin/bash
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh # Miniconda
bash Miniconda3-latest-Linux-x86_64.sh
</code></pre>
<p>运行脚本后，会出现用户协议的阅读，一直回车到出现 “yes” or “no” 的选项。可以在输入 yes 后的提示框中输入具体路径并用回车安装（必须是空路径）。直接回车就是默认路径。</p>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102164123643.png"></p>
<p>安装完选择是否用 conda 环境初始化，即用 conda base 环境替换 <code>$SHELL</code>。仅修改当前权限下的 <code>.bashrc</code>。输入 yes，再次打开命令行的时候最前面就会有一个 <code>(base)</code>。</p>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102164605317.png"></p>
<p> 输入<code>conda --version</code> 检查安装是否成功。</p>
<pre><code class="bash">conda --version
# response
conda 24.9.2
</code></pre>
<p><strong>添加镜像</strong></p>
<p>在安装路径下的<code>.condarc</code> 文件中添加相应的镜像。</p>
<pre><code class="yaml">channels:
 - defaults
show_channel_urls: true
channel_alias: https://mirrors.tuna.tsinghua.edu.cn/anaconda
default_channels:
 - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
 - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free
 - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
 - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/pro
 - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2
custom_channels:
 pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
</code></pre>
<h3 id="1-2-新建-Conda-环境"><a href="#1-2-新建-Conda-环境" class="headerlink" title="1.2. 新建 Conda 环境"></a>1.2. 新建 Conda 环境</h3><p>以 LLaVA 为例，新建专属 conda 环境。<code>-n</code> 指定环境名称，<code>python=3.x</code> 指定 python 版本， <code>-y</code> 表示同意安装过程中所有选项，用于快捷安装。</p>
<pre><code class="bash">conda create -n llava python=3.10 -y
</code></pre>
<p>安装完后可以检查是否安装成功。</p>
<pre><code class="bash">conda env list # 检查环境列表
conda activate llava # 如果环境存在，则激活
</code></pre>
<p>之后<code>(base)</code> 就会被替换成指定的环境名称，在 Anaconda 中，系统会默认在虚拟环境汇总下载好一些需要的库，可以直接用 pip 下载。使用<code>pip show pip</code> 检查 <code>pip</code> 路径，确保下载到当前环境中。如果 <code>which pip</code> 显示的不是当前环境的位置，那么需要考虑修改环境变量等内容。（可能是在系统下安装了 python，需要注释掉 <code>.pyenv</code> 等）</p>
<pre><code>Name: pip
Version: 24.2
Summary: The PyPA recommended tool for installing Python packages.
Home-page: https://pip.pypa.io/
Author: 
Author-email: The pip developers &lt;distutils-sig@python.org&gt;
License: MIT
Location: /path/to/your/anaconda3/envs/llavaOV/lib/python3.10/site-packages
Requires: 
Required-by: 
</code></pre>
<h2 id="2-配置CUDA、CUDNN"><a href="#2-配置CUDA、CUDNN" class="headerlink" title="2. 配置CUDA、CUDNN"></a>2. 配置CUDA、CUDNN</h2><p>CUDA 是用于并行计算，和 GPU 加速的计算平台和编程模型。cuDNN 主要用于深度神经网络（DNN）的训练和推理，提供了高性能的基本操作和优化，以加速深度学习任务。</p>
<h3 id="2-1-下载并配置-cuda"><a href="#2-1-下载并配置-cuda" class="headerlink" title="2.1. 下载并配置 cuda"></a>2.1. 下载并配置 cuda</h3><p>使用 <code>nvidia-smi</code> 和 <code>nvcc -V</code> 检查 cuda 版本是否一致。在 <code>nvidia-smi</code> 中，通过 <code>CUDA Version: </code> 查看当前的 cuda 版本；在 <code>nvcc -V</code> 中可以在 <code>Cuda compilation tools, release</code> 后面查看 cuda 编辑器版本。发现版本不匹配。</p>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102192847963.png"></p>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102192859663.png"></p>
<p>从 CUDA Toolkit Archive （<a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-toolkit-archive">官网链接</a>）下载相应的 CUDA Toolkit。根据电脑配置选择（操作系统、结构、分布、系统版本以及安装器类型）根据固定指令下载。以 Ubuntu 18.04 为例，进入 cuda 下载目录，运行以下命令：</p>
<pre><code class="bash">wget https://developer.download.nvidia.com/compute/cuda/11.8.0/local_installers/cuda_11.8.0_520.61.05_linux.run  # 从互联网上下载 cuda 安装器
bash cuda_11.8.0_520.61.05_linux.run  # 运行安装程序
</code></pre>
<p>运行安装程序，如果没有出现错误信息，等待一会会跳出用户协议，输入 accept 继续。</p>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102192723385.png"></p>
<p>下一步，去掉驱动器（Driver）前面的√，不更新驱动。</p>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102193925338.png"></p>
<p>出现权限问题，因为不是 rooter，所以无法在 <code>/usr/local/cuda-11.8</code> 安装 cuda，需要修改安装目录以及环境。</p>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102193054618.png"></p>
<pre><code class="bash">sh cuda_11.8.0_520.61.05_linux.run --installpath=path/to/your/cuda-11.8
</code></pre>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102194145786.png"></p>
<p>安装完成，根据提示添加环境变量。以下是命令：</p>
<pre><code class="bash"># add PATH &amp; LD_LIBRARY_PATH
export CUDA_HOME=/path/to/your/cuda-11.8
export PATH=$CUDA_HOME/bin:$PATH
export LD_LIBRARY_PATH=$CUDA_HOME/lib64:$LD_LIBRARY_PATH
export PATH=$CUDA_HOME/lib64:$PATH

# uninstall CUDA Toolkit
cuda-11.8/bin/cuda-uninstaller
</code></pre>
<h3 id="2-2-下载并配置-cuDNN"><a href="#2-2-下载并配置-cuDNN" class="headerlink" title="2.2. 下载并配置 cuDNN"></a>2.2. 下载并配置 cuDNN</h3><p>cuDNN 下载网址（<a target="_blank" rel="noopener" href="https://developer.nvidia.com/rdp/cudnn-archive">网页链接</a>），选择与 cuda 匹配的版本进行下载。下载 cuDNN 需要用邮箱在NVIDIA官网（<a target="_blank" rel="noopener" href="https://developer.nvidia.com/login">官网链接</a>）注册一个账户。如果直接使用 <code>wget</code> 下载会得到一个 <code>index.html</code> 文件。因此在本地下载后通过 Remote SSH 传入服务器。</p>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102191433513.png"></p>
<p>成功上传服务器后解压文件。</p>
<pre><code class="bash"># in your upload path
unxz cudnn-linux-x86_64-8.9.7.29_cuda11-archive.tar.xz # remove xz
tar -xvf cudnn-linux-x86_64-8.9.7.29_cuda11-archive.tar.xz # unzip
</code></pre>
<p>解压完成后会得到相应的文件夹。</p>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102203027930.png"></p>
<p>安装好之后将对应的 cudnn 文件加入 cuda 文件夹中即可插入使用。</p>
<pre><code class="bash">CUDA_BASE=&quot;/path/to/your/cuda&quot;
cp include/cudnn*.h $&#123;CUDA_BASE&#125;/cuda-11.8/include/
cp lib/libcudnn* $&#123;CUDA_BASE&#125;/cuda-11.8/lib64
chmod a+r $&#123;CUDA_BASE&#125;/cuda-11.8/include/cudnn*.h $&#123;CUDA_BASE&#125;/cuda-11.8/lib64/libcudnn*
</code></pre>
<p>输入以下命令检查是否成功安装 cudnn。</p>
<pre><code class="bash">cat /path/to/your/cuda-11.8/include/cudnn_version.h | grep CUDNN_MAJOR -A 2 
</code></pre>
<p>输出结果，可以看到 CUDNN，说明已经成功安装 cudnn。</p>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102204532616.png"></p>
<h2 id="3-配置-git"><a href="#3-配置-git" class="headerlink" title="3. 配置 git"></a>3. 配置 git</h2><p>配置一些基本信息</p>
<pre><code class="bash">git config --global user.name &lt;your name&gt;
git config --global user.email &lt;your email&gt;
git config --list
</code></pre>
<p>生成密钥，在 <em>Enter file in which to save the key</em> 后面添加保存的密钥，会在对应路径下生成一个 <code>id_rsa</code> 文件和一个 <code>id_rsa.pub</code> 文件。添加完毕后会输出保存的位置。</p>
<pre><code class="bash"># generate private keys
ssh-keygen -t rsa
</code></pre>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102213235724.png"></p>
<p>将 <code>id_rsa.pub</code> 中的内容复制到 <code>github</code> 个人主页（<code>https://github.com/settings/profile</code>）然后在 access 中找到 <em>SSH and GPG keys</em>。</p>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102213324385.png"></p>
<p>通过在 SSH keys 中 添加新的 SSH key，将<code>id_rsa.pub</code> 中的内容粘贴进去然后保存即可。</p>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102213509837.png"></p>
<p>以 <code>llava-next</code> 为例，使用 <code>git@</code> 似乎会遇到一点问题。</p>
<pre><code class="bash">git clone https://github.com/LLaVA-VL/LLaVA-NeXT.git
</code></pre>
<h2 id="4-配置-git-lfs"><a href="#4-配置-git-lfs" class="headerlink" title="4. 配置 git-lfs"></a>4. 配置 git-lfs</h2><p>用于从 hugging face 上下载模型权重及其他文件。</p>
<p>从 <a target="_blank" rel="noopener" href="https://github.com/git-lfs/git-lfs/releases">git-lfs github 仓库</a> 选择合适的版本下载压缩包（<code>.tar.gz</code> 文件）并解压到指定位置。（以<code>v3.5.1</code>为例）</p>
<pre><code class="bash"># /bin/bash
cd path/to/your/dir
wget https://github.com/git-lfs/git-lfs/releases/download/v3.5.1/git-lfs-linux-amd64-v3.5.1.tar.gz
tar -zx git-lfs-linux-amd64-v3.5.1.tar.gz
</code></pre>
<p>解压后得到一个对应版本的文件夹，里面有个 <code>install.sh</code>，是将 <code>git-lfs</code> 命令下载到<code>/usr/local</code> 中，在文件中修改 <code>prefix</code> 变量可以修改下载路径，将 <code>git-lfs</code> 下载到指定位置。之前使用 <code>git lfs install</code> 一直找不到命令是因为没有将自定义后的 <code>prefix</code> 这个位置加入环境变量导致系统无法找到，修改 <code>~/.bashrc</code> 可以解决这个问题。</p>
<p><img src="/2025/03/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20241102205615456.png"></p>
<pre><code class="bash"># export PATH
export PATH=$PATH:/path/to/your/lfs/bin
# initialize git-lfs
git lfs install
# system response
Git LFS initialized.
</code></pre>

    </div>
    
    
    
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2025 - 2025 SharlotAway
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;Sharlot Away
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
</body>
</html>
